(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[374],{1215:(e,t,s)=>{"use strict";s.d(t,{dj:()=>m});var a=s(2149);let r=0,l=new Map,i=e=>{if(l.has(e))return;let t=setTimeout(()=>{l.delete(e),o({type:"REMOVE_TOAST",toastId:e})},1e6);l.set(e,t)},n=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?i(s):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},d=[],c={toasts:[]};function o(e){c=n(c,e),d.forEach(e=>{e(c)})}function u(e){let{...t}=e,s=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>o({type:"DISMISS_TOAST",toastId:s});return o({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||a()}}}),{id:s,dismiss:a,update:e=>o({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function m(){let[e,t]=a.useState(c);return a.useEffect(()=>(d.push(t),()=>{let e=d.indexOf(t);e>-1&&d.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>o({type:"DISMISS_TOAST",toastId:e})}}},1240:(e,t,s)=>{"use strict";s.d(t,{J:()=>d,UserProvider:()=>n});var a=s(8081),r=s(2149),l=s(7786);let i=(0,r.createContext)(void 0);function n(e){let{children:t}=e,[s,n]=(0,r.useState)(null),[d,c]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{(()=>{let e=sessionStorage.getItem("currentUser");e&&n((0,l.kl)(e)),c(!1)})()},[]),(0,r.useEffect)(()=>{s?sessionStorage.setItem("currentUser",s.id):sessionStorage.removeItem("currentUser")},[s]),(0,a.jsx)(i.Provider,{value:{user:s,isLoading:d,setUser:n},children:t})}function d(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useUser must be used within a UserProvider");return e}},1860:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(1018).A)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]])},2950:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(1018).A)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},3054:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>v});var a=s(8081),r=s(2149),l=s(5160),i=s(900),n=s(4615),d=s(2950),c=s(1860),o=s(1018);let u=(0,o.A)("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]),m=(0,o.A)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),f=(0,o.A)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var x=s(1240),p=s(7786),h=s(5192),g=s(1215),y=s(7124);function v(){let{user:e}=(0,x.J)(),{toast:t}=(0,g.dj)(),[s,o]=(0,r.useState)([]),[v,j]=(0,r.useState)(null),[N,w]=(0,r.useState)([]),[b,S]=(0,r.useState)(new Map),[k,I]=(0,r.useState)(""),[T,E]=(0,r.useState)(""),[A,C]=(0,r.useState)(!1),[D,O]=(0,r.useState)(""),[M,_]=(0,r.useState)([]),[L,R]=(0,r.useState)(!1),K=(0,r.useRef)(null),U=(0,r.useRef)(null),V=(0,r.useRef)(null);function P(e){return e.split(" ").map(e=>e[0]).join("").toUpperCase()}function q(e){let t=new Date(e),s=new Date;if(t.toDateString()===s.toDateString())return t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});let a=new Date(s);return(a.setDate(s.getDate()-1),t.toDateString()===a.toDateString())?"Yesterday":t.toLocaleDateString()}async function z(t){var s;if(!e)return;let a=(0,p.LW)(e.id,t).map(e=>({id:e.id,senderId:e.senderId,recipientId:t,encryptedText:e.encryptedText,signature:e.signature,timestamp:e.timestamp}));w(a);let r=new Map;for(let t of a)if(t.senderId===e.id){let s=localStorage.getItem("msg-self-".concat(t.id));if(s)try{let{encryptedTextSelf:a}=JSON.parse(s),l=await (0,y.NQ)(a,e.privateKey);r.set(t.id,l);continue}catch(e){}}else try{let s=await (0,y.NQ)(t.encryptedText,e.privateKey),a=(0,p.kl)(t.senderId).publicKey,l=await (0,y.Od)(t.encryptedText,t.signature,a);r.set(t.id,l?s:"[Signature verification failed]")}catch(e){r.set(t.id,"[Decryption failed]")}S(r),(0,p.iS)(t,e.id),o(e=>e.map(e=>e.id===t?{...e,unread:0}:e)),null===(s=K.current)||void 0===s||s.scrollIntoView({behavior:"smooth"})}async function G(){if(!e||!v||!k.trim())return;let s=e.id,a=e.privateKey,r=e.publicKey,l=v.publicKey,i=await (0,p.um)(s,v.id,k,a,l);if(!i)return t({title:"Send failed",variant:"destructive"});let n=await (0,y.encryptMessage)(k,r),d=await (0,y.signMessage)(k,a);localStorage.setItem("msg-self-".concat(i.id),JSON.stringify({encryptedTextSelf:n,signatureSelf:d}));let c={id:i.id,senderId:i.senderId,recipientId:v.id,encryptedText:i.encryptedText,signature:i.signature,timestamp:i.timestamp,encryptedTextSelf:i.encryptedText,signatureSelf:i.signature};w(e=>[...e,c]),S(e=>new Map(e).set(c.id,k)),I(""),o(e=>e.map(e=>e.id===v.id?{...e,lastMessage:"Encrypted message",lastMessageTime:q(c.timestamp)}:e))}function F(e){j(e),S(new Map),z(e.id)}(0,r.useEffect)(()=>{e&&function(){if(!e)return;let t=(0,p.jF)(e.id).map(t=>{let s=(0,p.kl)(t);if(!s)return null;let a=(0,p.A)(e.id,t);return{id:s.id,name:s.name,initials:P(s.name),studentId:s.studentId,lastMessage:a?"Encrypted message":void 0,lastMessageTime:a?q(a.timestamp):void 0,unread:(0,p.aD)(t,e.id),online:Math.random()>.5,publicKey:s.publicKey}}).filter(Boolean);o(t),t.length&&!v&&F(t[0])}()},[e]),(0,r.useEffect)(()=>{D.trim()?function(){if(!D.trim()){_([]);return}_((0,p.st)(D).filter(t=>t.id!==(null==e?void 0:e.id)&&!s.some(e=>e.id===t.id)))}():_([])},[D]);let J=s.filter(e=>e.name.toLowerCase().includes(T.toLowerCase())||e.studentId.includes(T));async function $(){if(v)try{let e=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720}},audio:!0});U.current&&(U.current.srcObject=e,await U.current.play().catch(console.error)),R(!0)}catch(e){console.error("Error accessing media devices:",e),t({title:"Error",description:"Could not access camera and microphone",variant:"destructive"})}}return((0,r.useEffect)(()=>()=>{var e;(null===(e=U.current)||void 0===e?void 0:e.srcObject)&&U.current.srcObject.getTracks().forEach(e=>e.stop())},[]),e)?(0,a.jsxs)("div",{className:"flex h-[calc(100vh-4rem)] w-full",children:[(0,a.jsxs)("div",{className:"w-80 border-r flex flex-col flex-shrink-0",children:[(0,a.jsxs)("div",{className:"p-4 border-b",children:[(0,a.jsxs)("div",{className:"relative mb-2",children:[(0,a.jsx)(d.A,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-gray-400"}),(0,a.jsx)(i.p,{placeholder:"Search contacts...",className:"pl-8",value:T,onChange:e=>E(e.target.value)})]}),(0,a.jsxs)(l.$,{variant:"outline",className:"w-full",onClick:()=>C(!0),children:[(0,a.jsx)(c.A,{className:"h-4 w-4 mr-2"})," Add Contact"]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:J.length?J.map(e=>(0,a.jsxs)("button",{className:"w-full text-left p-3 border-b hover:bg-gray-50 flex items-center ".concat((null==v?void 0:v.id)===e.id?"bg-gray-50":""),onClick:()=>F(e),children:[(0,a.jsxs)(n.eu,{className:"h-10 w-10 mr-3",children:[e.avatar&&(0,a.jsx)(n.BK,{src:e.avatar,alt:e.name}),(0,a.jsx)(n.q5,{children:e.initials})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("h3",{className:"font-medium truncate",children:e.name}),(0,a.jsx)("span",{className:"text-xs text-gray-500 ml-2",children:e.lastMessageTime})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.studentId}),(0,a.jsx)("p",{className:"text-sm text-gray-600 truncate",children:e.lastMessage})]}),e.unread>0&&(0,a.jsx)("span",{className:"ml-2 bg-primary text-primary-foreground text-xs rounded-full h-5 w-5 flex items-center justify-center",children:e.unread})]},e.id)):(0,a.jsx)("div",{className:"p-4 text-center text-gray-500",children:T?"No contacts found":"No contacts yet. Add one to start messaging."})})]}),(0,a.jsx)("div",{className:"flex-1 flex flex-col w-full",children:v&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"p-4 border-b flex items-center justify-between flex-shrink-0",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)(n.eu,{className:"h-10 w-10 mr-3",children:[v.avatar&&(0,a.jsx)(n.BK,{src:v.avatar,alt:v.name}),(0,a.jsx)(n.q5,{children:v.initials})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"font-medium",children:v.name}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:[v.studentId," â€¢ ",v.online?"Online":"Offline"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)(l.$,{variant:"outline",size:"sm",onClick:()=>$(),children:[(0,a.jsx)(u,{className:"h-4 w-4 mr-2"}),"Video Call"]}),(0,a.jsxs)("div",{className:"flex items-center text-green-600 text-sm",children:[(0,a.jsx)(m,{className:"h-4 w-4 mr-1"})," End-to-end encrypted"]})]})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50 w-full",children:[N.length?N.map(t=>{var s;return(0,a.jsx)("div",{className:"flex ".concat(t.senderId===e.id?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-[70%] rounded-lg p-3 ".concat(t.senderId===e.id?"bg-primary text-primary-foreground":"bg-white shadow-sm"),children:[(0,a.jsx)("p",{children:null!==(s=b.get(t.id))&&void 0!==s?s:"Decrypting..."}),(0,a.jsx)("p",{className:"text-xs mt-1 opacity-70",children:q(t.timestamp)})]})},t.id)}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-gray-500",children:s.length?"No messages yet":"Add a contact to start messaging"}),(0,a.jsx)("div",{ref:K})]}),(0,a.jsx)("div",{className:"p-4 border-t bg-white flex-shrink-0",children:(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),G()},className:"flex items-center space-x-2",children:[(0,a.jsx)(i.p,{placeholder:"Type a message...",value:k,onChange:e=>I(e.target.value),className:"flex-1"}),(0,a.jsx)(l.$,{type:"submit",size:"icon",children:(0,a.jsx)(f,{className:"h-4 w-4"})})]})})]})}),(0,a.jsx)(h.lG,{open:A,onOpenChange:C,children:(0,a.jsxs)(h.Cf,{children:[(0,a.jsxs)(h.c7,{children:[(0,a.jsx)(h.L3,{children:"Add New Contact"}),(0,a.jsx)(h.rr,{children:"Search by student ID or name"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"flex space-x-2",children:(0,a.jsx)(i.p,{placeholder:"Enter student ID or name...",value:D,onChange:e=>O(e.target.value),className:"flex-1",autoFocus:!0})}),(0,a.jsx)("div",{className:"max-h-60 overflow-y-auto",children:M.length?M.map(s=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-md hover:bg-gray-50",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(n.eu,{className:"h-8 w-8 mr-3",children:(0,a.jsx)(n.q5,{children:P(s.name)})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:s.name}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:s.studentId})]})]}),(0,a.jsx)(l.$,{size:"sm",onClick:()=>(function(s){if(!e)return;let a={id:s.id,name:s.name,initials:P(s.name),studentId:s.studentId,unread:0,online:Math.random()>.5,publicKey:s.publicKey};o(e=>[a,...e]),C(!1),O(""),_([]),F(a),t({title:"Contact added",description:"".concat(a.name," added.")})})(s),children:"Add"})]},s.id)):D?(0,a.jsx)("p",{className:"text-center text-gray-500 py-4",children:"No students found"}):(0,a.jsx)("p",{className:"text-center text-gray-500 py-4",children:"Enter query to search"})})]}),(0,a.jsx)(h.Es,{children:(0,a.jsx)(l.$,{variant:"outline",onClick:()=>C(!1),children:"Cancel"})})]})}),(0,a.jsx)(h.lG,{open:L,onOpenChange:R,children:(0,a.jsxs)(h.Cf,{className:"sm:max-w-[800px]",children:[(0,a.jsx)(h.c7,{children:(0,a.jsxs)(h.L3,{children:["Video Call with ",null==v?void 0:v.name]})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"relative aspect-video bg-black rounded-lg overflow-hidden",children:[(0,a.jsx)("video",{ref:U,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",style:{transform:"scaleX(-1)"}}),(0,a.jsx)("div",{className:"absolute bottom-2 left-2 text-white text-sm bg-black/50 px-2 py-1 rounded",children:"You"})]}),(0,a.jsxs)("div",{className:"relative aspect-video bg-black rounded-lg overflow-hidden",children:[(0,a.jsx)("video",{ref:V,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),(0,a.jsx)("div",{className:"absolute bottom-2 left-2 text-white text-sm bg-black/50 px-2 py-1 rounded",children:null==v?void 0:v.name})]})]}),(0,a.jsx)("div",{className:"flex justify-center space-x-4 mt-4",children:(0,a.jsx)(l.$,{variant:"outline",onClick:function(){var e;if(null===(e=U.current)||void 0===e?void 0:e.srcObject){let e=U.current.srcObject;e.getTracks().forEach(t=>{t.stop(),e.removeTrack(t)}),U.current.srcObject=null}R(!1)},children:"End Call"})})]})})]}):(0,a.jsx)("div",{className:"p-6",children:"Loading..."})}},4615:(e,t,s)=>{"use strict";s.d(t,{BK:()=>d,eu:()=>n,q5:()=>c});var a=s(8081),r=s(2149),l=s(4812),i=s(7687);let n=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.bL,{ref:t,className:(0,i.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...r})});n.displayName=l.bL.displayName;let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l._V,{ref:t,className:(0,i.cn)("aspect-square h-full w-full",s),...r})});d.displayName=l._V.displayName;let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.H4,{ref:t,className:(0,i.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...r})});c.displayName=l.H4.displayName},4812:(e,t,s)=>{"use strict";s.d(t,{H4:()=>N,_V:()=>j,bL:()=>v});var a=s(2149),r=s(455),l=s(9962),i=s(2212),n=s(1905),d=s(8081),c="Avatar",[o,u]=(0,r.A)(c),[m,f]=o(c),x=a.forwardRef((e,t)=>{let{__scopeAvatar:s,...r}=e,[l,i]=a.useState("idle");return(0,d.jsx)(m,{scope:s,imageLoadingStatus:l,onImageLoadingStatusChange:i,children:(0,d.jsx)(n.sG.span,{...r,ref:t})})});x.displayName=c;var p="AvatarImage",h=a.forwardRef((e,t)=>{let{__scopeAvatar:s,src:r,onLoadingStatusChange:c=()=>{},...o}=e,u=f(p,s),m=function(e,t){let[s,r]=a.useState("idle");return(0,i.N)(()=>{if(!e){r("error");return}let s=!0,a=new window.Image,l=e=>()=>{s&&r(e)};return r("loading"),a.onload=l("loaded"),a.onerror=l("error"),a.src=e,t&&(a.referrerPolicy=t),()=>{s=!1}},[e,t]),s}(r,o.referrerPolicy),x=(0,l.c)(e=>{c(e),u.onImageLoadingStatusChange(e)});return(0,i.N)(()=>{"idle"!==m&&x(m)},[m,x]),"loaded"===m?(0,d.jsx)(n.sG.img,{...o,ref:t,src:r}):null});h.displayName=p;var g="AvatarFallback",y=a.forwardRef((e,t)=>{let{__scopeAvatar:s,delayMs:r,...l}=e,i=f(g,s),[c,o]=a.useState(void 0===r);return a.useEffect(()=>{if(void 0!==r){let e=window.setTimeout(()=>o(!0),r);return()=>window.clearTimeout(e)}},[r]),c&&"loaded"!==i.imageLoadingStatus?(0,d.jsx)(n.sG.span,{...l,ref:t}):null});y.displayName=g;var v=x,j=h,N=y},5192:(e,t,s)=>{"use strict";s.d(t,{Cf:()=>u,Es:()=>f,L3:()=>x,c7:()=>m,lG:()=>d,rr:()=>p});var a=s(8081),r=s(2149),l=s(2254),i=s(2522),n=s(7687);let d=l.bL;l.l9;let c=l.ZL;l.bm;let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.hJ,{ref:t,className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});o.displayName=l.hJ.displayName;let u=r.forwardRef((e,t)=>{let{className:s,children:r,...d}=e;return(0,a.jsxs)(c,{children:[(0,a.jsx)(o,{}),(0,a.jsxs)(l.UC,{ref:t,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...d,children:[r,(0,a.jsxs)(l.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(i.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=l.UC.displayName;let m=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};m.displayName="DialogHeader";let f=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};f.displayName="DialogFooter";let x=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.hE,{ref:t,className:(0,n.cn)("text-lg font-semibold leading-none tracking-tight",s),...r})});x.displayName=l.hE.displayName;let p=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.VY,{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",s),...r})});p.displayName=l.VY.displayName},5878:(e,t,s)=>{Promise.resolve().then(s.bind(s,3054))}},e=>{var t=t=>e(e.s=t);e.O(0,[573,739,103,497,954,358],()=>t(5878)),_N_E=e.O()}]);